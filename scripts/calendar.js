"use strict";function setCalendarMonthTitle(e){var t=e,a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=a[t.getMonth()]+" "+t.getFullYear();document.getElementById("titleMonth").innerHTML=n}function setCalendarWeekTitle(e){var t=e.week[0].date+" - "+e.week[4].date;document.getElementById("titleWeek").innerHTML=t}function setCalendarArray(e){var t,a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=e,s={week:[]};for(t=0;t<7;t++){var i,o=n.getDate()+t;i=n.getDay()+t>6?a[n.getDay()+t-7]:a[n.getDay()+t],s.week.push({day:i,date:o})}return s}function getCalendarJSON(){return $.getJSON("data/calendar.json").then(function(e){return e})}function returnCurrentDay(e){var t=new Date,a=0;for(e&&(a=e);a>7;)a-=7;return t.setDate(t.getDate()+a),t.getDay()}function dayIntToSring(e){for(var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=e;a>7;)a-=7;return t[a]}function getCookie(e){var t="; "+document.cookie,a=t.split("; "+e+"=");if(2==a.length)return a.pop().split(";").shift()}function processJourneys(e){$.when($.ajax({dataType:"json",type:"POST",data:"",url:"https://p6flgqzkv2.execute-api.eu-west-1.amazonaws.com/stage1/journeys/get"}),$.ajax({dataType:"json",crossDomain:!0,type:"POST",data:JSON.stringify({id:getCookie("Cookie")}),url:"https://p6flgqzkv2.execute-api.eu-west-1.amazonaws.com/stage1/user/login/check"})).done(function(e,t){for(var a=e[0].Items,n=0;n<a.length;n++)a[n].userId===t[0]||delete a[n];var s=[],i=new Date;i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);for(var o=0;o<7;o++)s.push({day:i.getDay(),date:i.getDate(),month:i.getMonth(),year:i.getFullYear(),no_travel:!1,single_journey:!1,journeys:[]}),i.setDate(i.getDate()+1);var r,d;for(r=0;r<a.length;r++)if(a[r].pattern.is_journey)if(a[r].pattern.is_recurring)for(d=0;d<7;d++)s[d].single_journey||a[r].pattern.days_of_week.includes(returnCurrentDay(d))&&(s[d].journeys.push({name:a[r].origin.name,postcode:a[r].origin.postcode,time:a[r].origin.time,type:"outbound"}),a[r].pattern.is_return&&s[d].journeys.push({name:a[r].destination.name,postcode:a[r].destination.postcode,time:a[r].destination.time,type:"return"}));else{var l;for(l=0;l<7;l++){var u=new Date;u.setHours(0),u.setMinutes(0),u.setSeconds(0),u.setMilliseconds(0);var c=new Date(a[r].start_date);u<c&&(u.setDate(u.getDate()+7),c<=u&&s[l].day===c.getDay()&&(s[l].single_journey||(s[l].single_journey=!0,s[l].journeys=[]),s[l].journeys.push({name:a[r].origin.name,postcode:a[r].origin.postcode,time:a[r].origin.time,type:"outbound"}),a[r].pattern.is_return&&s[l].journeys.push({name:a[r].destination.name,postcode:a[r].destination.postcode,time:a[r].destination.time,type:"return"})))}}else{var v=new Date(a[r].start_date),y=new Date;y.setHours(0),y.setMinutes(0),y.setSeconds(0),y.setMilliseconds(0);var f=new Date;if(f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0),f.setDate(y.getDate()+7),y<v&&v<=f)for(var g=0;g<7;g++)s[g].day===v.getDay()&&(s[g].no_travel=!0)}var m;for(m=0;m<7;m++)0===s[m].journeys.length&&(s[m].no_travel=!0);var p,j="";for(p=0;p<7;p++){var o;if(j+="<div class='mat-cal-foot-day-element'><div class='date'>",j+=s[p].date,j+="<div class='day'>",j+=dayIntToSring(s[p].day),j+="</div></div><div class='mat-cal-foot-day-journey'>",s[p].no_travel)j+="<div class='mat-cal-foot-day-journey-element bg-danger'><div class='title'>",j+="No Travel Today",j+="</div><div class='icon'><i class='fas fa-minus-circle'></i></div></div>";else for(o=0;o<s[p].journeys.length;o++){j+="<div class='mat-cal-foot-day-journey-element bg-"+s[p].journeys[o].type+"'><div class='title'>",j+=s[p].journeys[o].name,j+="</div><div class='location'><i class='fas fa-map-marker-alt'></i> ",j+=s[p].journeys[o].postcode,j+="</div><div class='time'><i class='fas fa-clock'></i> ",j+=s[p].journeys[o].time;var D;D="outbound"===s[p].journeys[o].type?"fa-arrow-right":"return"===s[p].journeys[o].type?"fa-arrow-left":"fa-sun",j+="</div><div class='icon'><i class='fas "+D+"'></i></div></div>"}j+="</div></div></div></div>"}document.getElementById("calendarContainer").innerHTML=j})}function setupCalendarDiv(e){var t,a="";getCalendarJSON().then(function(n){var s=n;for(t=0;t<7;t++){var i;for(a+="<div class='mat-cal-foot-day-element'><div class='date'>",a+=e.week[t].date,a+="<div class='day'>",a+=e.week[t].day,a+="</div></div><div class='mat-cal-foot-day-journey'>",i=0;i<s[t].length;i++){a+="<div class='mat-cal-foot-day-journey-element bg-"+s[t][i].event+"'><div class='title'>",a+=s[t][i].name,a+="</div><div class='location'><i class='fas fa-map-marker-alt'></i> ",a+=s[t][i].postcode,a+="</div><div class='time'><i class='fas fa-clock'></i> ",a+=s[t][i].time;var o;o="danger"==s[t][i].event?"fa-minus-circle":"evening"==s[t][i].event?"fa-moon":"fa-sun",a+="</div><div class='icon'><i class='fas "+o+"'></i></div></div>"}a+="</div></div></div></div>"}document.getElementById("calendarContainer").innerHTML=a})}function setupCalendar(){var e=new Date;setCalendarMonthTitle(e);var t=setCalendarArray(e);setCalendarWeekTitle(t),processJourneys(t)}setupCalendar();